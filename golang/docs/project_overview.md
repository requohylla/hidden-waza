# プロジェクト全体構成・設計思想・コーディングルール完全まとめ

このドキュメントは、LLMや新規開発者が本プロジェクトの全体像・設計思想・各層の責務・コーディングルールを「深く・具体的に」把握できるようにまとめたものです。

---

## ディレクトリ構成（主要部分・責務付き）

```
services/hidden_waza/
├── api/v1/dto/         # API入出力用DTO定義（外部とのデータ受け渡し専用）
├── cmd/hidden_waza/    # エントリポイント(main.go)・アプリ起動
├── config/             # DB設定ファイル（環境ごとに分離管理）
├── db/
│   ├── migrations/     # マイグレーションSQL（DBスキーマ管理・バージョン管理）
│   └── seeder/         # ダミーデータ投入（テスト・開発用）
├── internal/
│   ├── domain/         # ドメインモデル（DBテーブル対応の構造体。1ファイル1構造体原則）
│   ├── repository/     # リポジトリ（DBアクセス抽象化。ドメインモデル単位でCRUD）
│   ├── service/        # サービス層（ビジネスロジック集約。複数モデル横断・業務ルール）
│   └── handler/        # ハンドラー（APIリクエスト処理。DTO変換・バリデーション・サービス呼び出し）
docs/                   # ドキュメント（設計・運用・仕様全般）
```

---

## 各層の責務・設計思想（詳細）

### API層（DTO）

- 役割: 外部APIとのデータ受け渡し専用の構造体。JSON入出力の型安全性担保
- ポイント: ドメイン層やDB構造体と分離し、外部仕様変更の影響を最小化

### ハンドラー層

- 役割: HTTPリクエスト受信・DTOデコード・バリデーション・サービス層呼び出し・レスポンス生成
- ポイント: 業務ロジックはサービス層に委譲し、責務を「I/O制御」に限定

### サービス層

- 役割: ビジネスロジック（業務ルール・複数モデル横断処理・集計等）の集約
- ポイント: ドメインモデルやリポジトリを組み合わせ、業務的な意味を持つ処理を一元化
- 例: 職務経歴書作成時の複雑なバリデーション、ユーザー権限チェック、集計処理

### ドメイン層

- 役割: DBテーブルに対応した「モデル（構造体）」の定義。データ構造の標準表現
- ポイント: 1ファイル1構造体原則。ビジネスロジックは持たず、型・リレーション・属性のみを記述
- 例: [`resume.go`](services/hidden_waza/internal/domain/resume.go:1) にはResume構造体のみ

### リポジトリ層

- 役割: ドメインモデルとDBの橋渡し。GORM等ORMを使い、保存・取得・検索を抽象化
- ポイント: SQLやORMの詳細を隠蔽し、アプリ他層からは「ドメイン構造体単位でCRUD」できるようにする

### DB・Seeder

- 役割: DBスキーマ管理（マイグレーション）、ダミーデータ投入
- ポイント: マイグレーションはバージョン管理し、Seederは開発・テスト用に限定

---

## 1ファイル1構造体原則の詳細

- 各Goファイルには原則として「1つの構造体（モデル）」のみを定義
- 例：`resume.go`にはResume構造体のみ、`skill.go`にはSkill構造体のみ
- 構造体が肥大化した場合や関連が強い場合のみ、適切に分割・整理
- このルールにより、可読性・保守性・責務の明確化・Git差分の最小化を実現
- ドメイン層だけでなく、DTOやリポジトリ層でも同様の方針を推奨

---

## コーディングルール（詳細）

- Go言語の標準的な命名規則（キャメルケース、パッケージ名は小文字単語）
- ファイル・ディレクトリ名はsnake_case
- 1ファイル1構造体原則を厳守
- コメントは日本語で要点を簡潔に記述。外部公開関数・構造体にはGoDocコメント推奨
- エラー処理は明示的に行い、panicは極力避ける
- テスト容易性を意識し、各層の責務分離を徹底
- 外部パッケージはgo.modで管理し、不要な依存は削除
- DBマイグレーション・Seederは本番/開発で分離管理
- 機密情報は.envやconfigファイルで管理し、リポジトリに直書きしない
- PRレビュー時は「責務分離」「1ファイル1構造体」「命名規則」「コメント」「テスト容易性」を重点確認

---

## データの流れ（例：職務経歴書登録）

1. クライアント → API（JSON） → DTO
2. ハンドラー層でDTOデコード・バリデーション
3. サービス層でビジネスロジック実行
4. リポジトリ層でDB保存
5. 結果をハンドラー層経由でレスポンス

---

## ビジネスロジックの配置

- **サービス層**に集約（業務ルール・複雑なバリデーション・集計等）
- ハンドラー層はリクエスト処理・簡易バリデーションのみ
- ドメイン層は「データ構造の定義」に徹する
- リポジトリ層は「DBアクセスの抽象化」のみ

---

## 参考ドキュメント

- [`docs/api.md`](docs/api.md) … API仕様・実装詳細
- [`docs/domain.md`](docs/domain.md) … ドメインモデル設計
- [`docs/repository.md`](docs/repository.md) … リポジトリ設計
- [`docs/handler.md`](docs/handler.md) … ハンドラー設計
- [`docs/service.md`](docs/service.md) … サービス層設計
- [`docs/db/setting.md`](docs/db/setting.md) … DB・マイグレーション
- [`docs/db/seeder.md`](docs/db/seeder.md) … Seeder利用手順

---

## 補足

- サービス層未実装の場合はハンドラー層にビジネスロジックが一時的に記述されている場合あり
- テスト容易性・保守性向上のため、今後も各層の責務分離を推奨
- 1ファイル1構造体原則は、将来的な大規模化やチーム開発にも強い構成を実現
